angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){"use strict";function a(a,b){return angular.equals(a,b)}function b(){for(var a=p,b=p,c=[],d=[];b--;)d.push("");for(;a--;)c.push(d.slice());return c}function c(){return b()}function d(a){return JSON.parse(JSON.stringify(a))}function e(a,c,d,e){function f(b,c){g.push([b,c]),h[b][c]=a,b-1>=0&&""===h[b-1][c]&&e[b-1][c]===a&&f(b-1,c),p>b+1&&""===h[b+1][c]&&e[b+1][c]===a&&f(b+1,c),p>c+1&&""===h[b][c+1]&&e[b][c+1]===a&&f(b,c+1),c-1>=0&&""===h[b][c-1]&&e[b][c-1]===a&&f(b,c-1)}var g=[],h=b();return f(c,d),{willadd:g,links:h}}function f(a,b){var c,e,f=d(a);for(c=0;p>c;c++)for(e=0;p>e;e++)""!==b[c][e]&&(f[c][e]=b[c][e]);return f}function g(a){var c,g,h,i=b(),j=b(),k=[],l=[];for(c=0;p>c;c++)for(g=0;p>g;g++)"X"===a[c][g]&&""===i[c][g]?(h=e("X",c,g,a),k.push(d(h.willadd)),i=f(i,h.links)):"O"===a[c][g]&&""===j[c][g]&&(h=e("O",c,g,a),l.push(d(h.willadd)),j=f(j,h.links));return{black:k,white:l}}function h(a,b){var c,e,f,g=d(a);for(c=0;c<b.length;c++)e=b[c][0],f=b[c][1],g[e][f]="";return g}function i(a,b){var c,e,f,g=0,i=d(a),j=0;for(e=0;e<b.length;e++){for(j=0,c=b[e],f=0;f<c.length;f++){var k=c[f][0],l=c[f][1];if(k-1>=0&&""===a[k-1][l]||p>k+1&&""===a[k+1][l]||l-1>=0&&""===a[k][l-1]||p>l+1&&""===a[k][l+1]){j++;break}}0===j&&(g+=c.length,i=h(i,c))}return{board:i,captured:g}}function j(a,b,c){var e,f=d(b),h=d(a),j=g(a),k=j.black,l=j.white;return 0===c&&(e=i(h,l),f.white=b.white+e.captured,h=d(e.board)),e=i(h,k),f.black=b.black+e.captured,h=d(e.board),1===c&&(e=i(h,l),f.white=b.white+e.captured,h=d(e.board)),{board:h,captured:f}}function k(a){var b="O";return a.black-a.white===0?b="":a.white>a.black&&(b="X"),b}function l(a,b,c,d,e){var f,g,h,i,j,k=[];for(f=0;p>f;f++)for(g=0;p>g;g++){h={row:f,col:g};try{if(i=n(a,b,h,c,d,e),j=i[3].set.value,0===e&&j.white>c.white||1===e&&j.black>c.black)return i;0===e&&j.black>c.black||1===e&&j.white>c.white||k.push(i)}catch(l){}}try{h={row:-1,col:-1},i=n(a,b,h,c,d,e),k.push(i)}catch(l){}var m=k[Math.floor(Math.random()*k.length)];return m}function m(a,b){var c,d,e=0,f=b?"O":"X";for(c=0;p>c;c++)for(d=0;p>d;d++)a[c][d]===f&&e++;return e}function n(a,c,e,f,g,h){void 0===f&&(f={black:0,white:0}),void 0===g&&(g=0),void 0===c&&(c=b()),void 0===a&&(a=b());var i,l;i=m(c,h);var n=d(c),o=g,p=d(f),q=e.row,r=e.col;if(-1===q&&-1===r){if(o++,o>2)throw Error("Exceeded number of possible passes.")}else{if(""!==n[q][r])throw Error("Space is not empty!");n[q][r]=0===h?"X":"O",o=0;var s=j(n,f,h);n=s.board,p=s.captured}if(l=m(n,h),i>=l&&l>0&&0===g&&0===o)throw Error("you can not suicide.");if(angular.equals(a,n)&&0===g&&0===o)throw Error("donâ€™t allow a move that brings the game back to stateBeforeMove.");var t;if(2===o){var u=k(p);t={endMatch:{endMatchScores:"X"===u?[1,0]:"O"===u?[0,1]:[0,0]}}}else t={setTurn:{turnIndex:1-h}};return[t,{set:{key:"board",value:n}},{set:{key:"delta",value:e}},{set:{key:"captured",value:p}},{set:{key:"passes",value:o}}]}function o(b){var c=b.move,d=b.turnIndexBeforeMove,e=b.stateBeforeMove;try{var f=c[2].set.value,g=n(e.boardbeforeMove,e.board,f,e.captured,e.passes,d);if(!a(c,g))return!1}catch(h){return!1}return!0}var p=19;return"?boardSize=9"===window.location.search&&(p=9),"?boardSize=19"===window.location.search&&(p=19),"?boardSize=13"===window.location.search&&(p=13),this.isMoveOk=o,this.getInitialBoard=c,this.createMove=n,this.createComputerMove=l,this.getSets=g,{isMoveOk:o,getInitialBoard:c,createComputerMove:l,createMove:n}}),window.touchElementId="boardArea",angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","gameLogic","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h){"use strict";function i(a,c,d){{var e=document.getElementById("draggingLines"),f=document.getElementById("horizontalDraggingLine"),g=document.getElementById("verticalDraggingLine"),h=document.getElementById("gameArea"),i=document.getElementById("boardArea"),k=c-h.offsetLeft,n=d-h.offsetTop;document.getElementById("button")}if(0>k||k>=h.clientWidth||0>n||n>=i.clientHeight)return e.style.displagy="none",void(clickToDragPiece.style.display="none");var o=Math.floor(r*k/i.clientWidth),p=Math.floor(q*n/i.clientHeight);if("X"!==b.board[p][o]&&"O"!==b.board[p][o]){clickToDragPiece.style.display="inline",e.style.display="inline";var s=l(p,o);g.setAttribute("x1",s.x),g.setAttribute("x2",s.x),f.setAttribute("y1",s.y),f.setAttribute("y2",s.y);var t=j(p,o),u=document.getElementById("circle");u.setAttribute("fill",0===b.turnIndex?"black":"white"),clickToDragPiece.style.left=t.left+"px",clickToDragPiece.style.top=t.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(clickToDragPiece.style.display="none",e.style.display="none",m(p,o))}}function j(a,b){var c=k();return{top:a*c.height,left:b*c.width}}function k(){var a=document.getElementById("boardArea");return{width:a.clientWidth/r,height:a.clientHeight/q}}function l(a,b){var c=k();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function m(d,e){a.$apply(function(){var a="Dragged to "+d+"x"+e;c.info(a),b.msg=a,p(d,e)})}function n(){e.makeMove(f.createComputerMove(b.boardbeforeMove,b.board,b.captured,b.passes,b.turnIndex))}function o(a){b.jsonState=angular.toJson(a.stateAfterMove,!0),b.board=a.stateAfterMove.board,b.delta=a.stateAfterMove.delta,b.captured=a.stateAfterMove.captured,b.passes=a.stateAfterMove.passes,(void 0===b.board||void 0===b.captured||void 0===b.passes)&&(b.board=f.getInitialBoard(),b.captured={black:0,white:0},b.passes=0,b.notifications="Nothing was dragged"),b.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,b.turnIndex=a.turnIndexAfterMove,b.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&d(n,1e3)}function p(a,d){if(c.info(["Clicked on cell:",a,d]),b.isYourTurn)try{var g={row:a,col:d},h=f.createMove(b.boardbeforeMove,b.board,g,b.captured,b.passes,b.turnIndex);b.boardbeforeMove=b.board,b.isYourTurn=!1,e.makeMove(h)}catch(i){return void c.info(["Cannot make move:",a,d])}}g.setWidthToHeight(.8),b.getButtonValue=function(){switch(b.passes){case 0:return"PASS";case 1:return"END_MATCH";case 2:return"GAME_OVER";default:return"PASS"}},b.numberOfRowsAndCols=19,b.boardSrc="imgs/board_19x19_2.png","?boardSize=9"===window.location.search&&(b.numberOfRowsAndCols=9,b.boardSrc="imgs/board.png"),"?boardSize=19"===window.location.search&&(b.numberOfRowsAndCols=19,b.boardSrc="imgs/board_19x19_2.png"),"?boardSize=13"===window.location.search&&(b.numberOfRowsAndCols=13,b.boardSrc="imgs/board1313.png");var q=b.numberOfRowsAndCols,r=b.numberOfRowsAndCols;b.getIntegersTill=function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b},h.addDragListener("boardArea",i),o({stateAfterMove:{},turnIndexAfterMove:0,yourPlayerIndex:-2}),b.passClicked=function(){if(c.info(["Clicked on pass.",b.passes]),b.isYourTurn)try{var a={row:-1,col:-1},d=f.createMove(b.boardbeforeMove,b.board,a,b.captured,b.passes,b.turnIndex);b.boardbeforeMove=b.board,b.isYourTurn=!1,e.makeMove(d)}catch(g){return void c.info(["Cannot pass.",b.passes])}},b.shouldSlowlyAppear=function(a,c){return void 0!==b.delta&&b.delta.row===a&&b.delta.col===c},b.isEmpty=function(a,c){return void 0!==b.board[a][c]&&""===b.board[a][c]},b.onDropComplete=function(a,d,g,h){if(c.info("onDropComplete happened!",arguments),b.notifications="Dropped piece "+a+" in "+g+"x"+h,c.info(b.isYourTurn),!b.isYourTurn||2===a)return void(b.notifications="You can't use that piece.");try{var i={row:g,col:h},j=f.createMove(b.boardbeforeMove,b.board,i,b.captured,b.passes,b.turnIndex);b.boardbeforeMove=b.board,b.isYourTurn=!1,e.makeMove(j)}catch(k){return void c.info(["Cannot make move:",g,h])}},e.setGame({gameDeveloperEmail:"zhuangzeleng1992@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:o})}]);
//# sourceMappingURL=everything.min.js.map